<Window x:Class="StageManagementSystem.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:StageManagementSystem"
        xmlns:views="clr-namespace:StageManagementSystem.Views"
        mc:Ignorable="d"
        Title="Stage &amp; Afstudeer Management" Height="700" Width="1000"
        MinHeight="600" MinWidth="900"
        WindowStyle="SingleBorderWindow" ResizeMode="CanResize"
        WindowStartupLocation="CenterScreen"
        UseLayoutRounding="True" SnapsToDevicePixels="True"
        TextOptions.TextFormattingMode="Display" TextOptions.TextRenderingMode="ClearType"
        Background="{DynamicResource Gray100}"> <!-- Using Gray100 as base background -->
    
    <Grid Background="{DynamicResource Gray100}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Header -->
            <RowDefinition Height="Auto"/> <!-- Dashboard -->
            <RowDefinition Height="*"/>    <!-- Main Content -->
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Background="{DynamicResource SurfaceBrush}" Padding="24,16" BorderBrush="{DynamicResource Gray200}" BorderThickness="0,0,0,1">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Orientation="Horizontal">
                    <Border CornerRadius="10" Width="40" Height="40" Margin="0,0,12,0">
                        <Border.Background>
                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                <GradientStop Color="#4f46e5" Offset="0"/>
                                <GradientStop Color="#7c3aed" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                        <TextBlock Text="&#xE125;" FontFamily="Segoe Fluent Icons, Segoe MDL2 Assets" FontSize="20" HorizontalAlignment="Center" VerticalAlignment="Center" Foreground="White"/>
                    </Border>
                    <StackPanel VerticalAlignment="Center">
                        <TextBlock Text="Stage &amp; Afstudeer Management" FontSize="18" FontWeight="Bold" Foreground="{DynamicResource Gray800}"/>
                        <TextBlock Text="HBO-ICT Begeleiding" FontSize="12" Foreground="{DynamicResource Gray600}"/>
                    </StackPanel>
                </StackPanel>

                <Button Grid.Column="2" Content="&#xE708;" 
                        FontFamily="Segoe Fluent Icons, Segoe MDL2 Assets"
                        Margin="0,0,12,0"
                        Width="40" Height="40"
                        Padding="0" FontSize="18"
                        Click="ToggleTheme_Click"
                        Style="{StaticResource BtnSecondary}"
                        ToolTip="Toggle Dark Mode"/>

                <Button Grid.Column="3" Command="{Binding ImportCommand}" Margin="0,0,12,0" Style="{StaticResource BtnSecondary}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#xE896;" FontFamily="Segoe Fluent Icons, Segoe MDL2 Assets" VerticalAlignment="Center" Margin="0,0,8,0" FontSize="16"/>
                        <TextBlock Text="Importeer" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>

                <Button Grid.Column="4" Command="{Binding ExportCommand}" Margin="0,0,12,0" Style="{StaticResource BtnSecondary}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#xE898;" FontFamily="Segoe Fluent Icons, Segoe MDL2 Assets" VerticalAlignment="Center" Margin="0,0,8,0" FontSize="16"/>
                        <TextBlock Text="Exporteer" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>

                <Button Grid.Column="5" Command="{Binding AddStudentCommand}" Style="{StaticResource BtnPrimary}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Text="&#xE710;" FontFamily="Segoe Fluent Icons, Segoe MDL2 Assets" VerticalAlignment="Center" Margin="0,0,8,0" FontSize="16" Foreground="White" FontWeight="Bold"/>
                        <TextBlock Text="Nieuwe Student" VerticalAlignment="Center" Foreground="White"/>
                    </StackPanel>
                </Button>
            </Grid>
        </Border>

        <!-- Dashboard (Collapsible if needed, but for now fixed top) -->
        <!-- Removed Dashboard row -> Moved to Detail View -->

        <!-- Main Content (List + Detail) -->
        <Grid Grid.Row="2" Margin="24">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="450" MinWidth="400" MaxWidth="600"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Left Panel: Stats Chips & Student List -->
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <Grid.Resources>
                    <!-- Style for Dashboard Tile Buttons -->
                    <Style x:Key="TileButtonStyle" TargetType="Button">
                        <Setter Property="Background" Value="Transparent"/>
                        <Setter Property="BorderThickness" Value="0"/>
                        <Setter Property="Padding" Value="0"/>
                        <Setter Property="Margin" Value="2"/>
                        <Setter Property="Cursor" Value="Hand"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="Button">
                                    <Border Background="{TemplateBinding Background}">
                                        <ContentPresenter/>
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </Grid.Resources>

                <!-- Stat Chips -->
                <UniformGrid Rows="1" Columns="4" Margin="0,0,0,10">
                    <!-- Danger Chip -->
                    <Button Command="{Binding FilterNeedsActionCommand}" Style="{StaticResource TileButtonStyle}">
                        <Border Background="{DynamicResource SurfaceBrush}" BorderBrush="{DynamicResource Gray200}" BorderThickness="1" CornerRadius="6" Padding="6,4">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <Rectangle Width="8" Height="8" RadiusX="4" RadiusY="4" Fill="{DynamicResource DangerColor}" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding NeedsActionCount, StringFormat='Actie: {0}'}" FontSize="11" FontWeight="SemiBold" Foreground="{DynamicResource Gray700}" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                    </Button>
                    <!-- Warning Chip -->
                    <Button Command="{Binding FilterInReviewCommand}" Style="{StaticResource TileButtonStyle}">
                        <Border Background="{DynamicResource SurfaceBrush}" BorderBrush="{DynamicResource Gray200}" BorderThickness="1" CornerRadius="6" Padding="6,4">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <Rectangle Width="8" Height="8" RadiusX="4" RadiusY="4" Fill="{DynamicResource WarningColor}" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding InReviewCount, StringFormat='Review: {0}'}" FontSize="11" FontWeight="SemiBold" Foreground="{DynamicResource Gray700}" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                    </Button>
                    <!-- Info Chip -->
                    <Button Command="{Binding FilterActiveCommand}" Style="{StaticResource TileButtonStyle}">
                        <Border Background="{DynamicResource SurfaceBrush}" BorderBrush="{DynamicResource Gray200}" BorderThickness="1" CornerRadius="6" Padding="6,4">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <Rectangle Width="8" Height="8" RadiusX="4" RadiusY="4" Fill="{DynamicResource InfoColor}" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding ActiveCount, StringFormat='Actief: {0}'}" FontSize="11" FontWeight="SemiBold" Foreground="{DynamicResource Gray700}" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                    </Button>
                    <!-- Success Chip -->
                    <Button Command="{Binding FilterCompletedCommand}" Style="{StaticResource TileButtonStyle}">
                        <Border Background="{DynamicResource SurfaceBrush}" BorderBrush="{DynamicResource Gray200}" BorderThickness="1" CornerRadius="6" Padding="6,4">
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                <Rectangle Width="8" Height="8" RadiusX="4" RadiusY="4" Fill="{DynamicResource SuccessColor}" Margin="0,0,6,0" VerticalAlignment="Center"/>
                                <TextBlock Text="{Binding CompletedMonthCount, StringFormat='Klaar: {0}'}" FontSize="11" FontWeight="SemiBold" Foreground="{DynamicResource Gray700}" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Border>
                    </Button>
                </UniformGrid>

                <views:StudentListView Grid.Row="1" DataContext="{Binding StudentListViewModel}"/>
            </Grid>
            
            <!-- Splitter -->
            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Center" VerticalAlignment="Stretch" Background="Transparent" ShowsPreview="True"/>
            
            <!-- Right Panel: Empty State (Dashboard) OR Detail View -->
            <Grid Grid.Column="2" Margin="10,0,0,0">
                <views:DashboardView Visibility="{Binding StudentListViewModel.SelectedStudent, Converter={StaticResource InverseNullToVisibilityConverter}}"/>
                <views:StudentDetailView DataContext="{Binding StudentDetailViewModel}" Visibility="{Binding StudentListViewModel.SelectedStudent, Converter={StaticResource NullToVisibilityConverter}}"/>
            </Grid>
        </Grid>
    </Grid>
</Window>
