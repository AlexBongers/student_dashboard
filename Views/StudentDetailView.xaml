<UserControl x:Class="StageManagementSystem.Views.StudentDetailView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:StageManagementSystem.Views"
             xmlns:helpers="clr-namespace:StageManagementSystem.Helpers"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="600">
    <Border Style="{StaticResource CardStyle}">
        <Grid>
            <!-- Content -->
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Header -->
                <Grid Margin="0,0,0,20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <Border Width="80" Height="80" CornerRadius="40" Background="{DynamicResource Gray100}" Margin="0,0,20,0" VerticalAlignment="Center" HorizontalAlignment="Left">
                        <Grid>
                            <TextBlock Text="&#xE77B;" FontFamily="Segoe Fluent Icons, Segoe MDL2 Assets" HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="36" Foreground="{DynamicResource Gray400}">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Student.ProfilePicturePath}" Value="{x:Null}">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Student.ProfilePicturePath}" Value="">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                            <Border CornerRadius="40" Width="80" Height="80">
                                <Border.Background>
                                    <ImageBrush ImageSource="{Binding Student.ProfilePicturePath}" Stretch="UniformToFill"/>
                                </Border.Background>
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="Visibility" Value="Visible"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Student.ProfilePicturePath}" Value="{x:Null}">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Student.ProfilePicturePath}" Value="">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                            </Border>
                        </Grid>
                    </Border>
                    
                    <Grid Grid.Column="1" VerticalAlignment="Center" Margin="0,0,16,0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <TextBlock Grid.Row="0" Text="{Binding Student.Name}" FontSize="24" FontWeight="Bold" Foreground="{DynamicResource Gray800}" TextTrimming="CharacterEllipsis"/>
                        <WrapPanel Grid.Row="1" Orientation="Horizontal" Margin="0,2,0,0">
                            <TextBlock Text="{Binding Student.StudentNumber}" Foreground="{DynamicResource Gray600}"/>
                            <TextBlock Text=" â€¢ " Foreground="{DynamicResource Gray600}"/>
                            <TextBlock Text="{Binding Student.Type}" Foreground="{DynamicResource Gray600}"/>
                            <TextBlock Text=" â€¢ " Foreground="{DynamicResource Gray600}"/>
                            <TextBlock Text="{Binding Student.MyRole}" Foreground="{DynamicResource PrimaryColor}" FontWeight="SemiBold"/>
                        </WrapPanel>
                         <WrapPanel Grid.Row="2" Orientation="Horizontal" Margin="0,4,0,0" VerticalAlignment="Center">
                             <TextBlock Text="&#xE715;" FontFamily="Segoe Fluent Icons, Segoe MDL2 Assets" VerticalAlignment="Center" Margin="0,0,8,0"/>
                             <TextBlock Text="{Binding Student.Email, TargetNullValue='Onbekend', FallbackValue='Onbekend'}" Foreground="{DynamicResource Gray600}" VerticalAlignment="Center" Margin="0,0,10,0" TextTrimming="CharacterEllipsis" MaxWidth="180"/>
                             
                             <Button Content="Stuur Email" Command="{Binding SendEmailCommand}" Style="{StaticResource BtnSecondary}" Padding="8,2" Margin="0,0,16,0" FontSize="10" ToolTip="Start nieuw bericht in standaard e-mailapp"/>

                             <TextBlock Text="&#xE717;" FontFamily="Segoe Fluent Icons, Segoe MDL2 Assets" VerticalAlignment="Center" Margin="0,0,8,0"/>
                             <TextBlock Text="{Binding Student.Phone, TargetNullValue='Onbekend', FallbackValue='Onbekend'}" Foreground="{DynamicResource Gray600}" VerticalAlignment="Center"/>
                         </WrapPanel>
                    </Grid>
                    <!-- Status Dropdown or Pill -->
                    <StackPanel Grid.Column="2" VerticalAlignment="Top" HorizontalAlignment="Right">
                        <ComboBox ItemsSource="{Binding AvailableStatuses}" 
                                  SelectedItem="{Binding SelectedStatus}" 
                                  Margin="0,0,0,8" 
                                  HorizontalAlignment="Right"
                                  Width="120" />
                        <Button Content="{Binding ArchiveButtonText}" Command="{Binding ArchiveStudentCommand}" Style="{StaticResource BtnSecondary}" Padding="12,6" FontSize="12"/>
                    </StackPanel>
                    
                    <!-- Close Button -->
                    <Button Grid.Column="3" Command="{Binding CloseCommand}" Style="{StaticResource BtnSecondary}" Width="32" Height="32" Padding="0" VerticalAlignment="Top" HorizontalAlignment="Right" Margin="10,0,0,0" ToolTip="Sluiten">
                        <TextBlock Text="&#xE711;" FontFamily="Segoe Fluent Icons, Segoe MDL2 Assets" FontSize="14" Foreground="{DynamicResource Gray600}"/>
                    </Button>
                </Grid>

                <!-- Tabs -->
                <TabControl Grid.Row="2" BorderThickness="0" Background="Transparent" Padding="0">
                    <TabControl.Resources>
                        <Style TargetType="TabItem">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="TabItem">
                                        <Border Name="Border" BorderThickness="0,0,0,2" BorderBrush="Transparent" Padding="12,8" Margin="0,0,4,0">
                                            <ContentPresenter x:Name="ContentSite"
                                                VerticalAlignment="Center"
                                                HorizontalAlignment="Center"
                                                ContentSource="Header"
                                                RecognizesAccessKey="True"/>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsSelected" Value="True">
                                                <Setter TargetName="Border" Property="BorderBrush" Value="{DynamicResource PrimaryColor}"/>
                                                <Setter Property="Foreground" Value="{DynamicResource PrimaryColor}"/>
                                                <Setter Property="FontWeight" Value="SemiBold"/>
                                            </Trigger>
                                            <Trigger Property="IsSelected" Value="False">
                                                <Setter Property="Foreground" Value="{DynamicResource Gray600}"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </TabControl.Resources>

                    <TabItem Header="Overzicht">
                        <ScrollViewer>
                            <StackPanel Margin="0,16,0,0">
                                <WrapPanel>
                                    <local:InfoBox Label="Bedrijf" Value="{Binding Student.Company}"/>
                                    <local:InfoBox Label="Locatie" Value="{Binding Student.Location}"/>
                                    <local:InfoBox Label="Opleiding" Value="{Binding Student.StudyProgram}"/>
                                    <local:InfoBox Label="Groep/Cohort" Value="{Binding Student.Cohort}"/>
                                    <local:InfoBox Label="Startdatum" Value="{Binding Student.StartDate, StringFormat=d}"/>
                                    <local:InfoBox Label="Einddatum" Value="{Binding Student.EndDate, StringFormat=d}"/>
                                </WrapPanel>
                            </StackPanel>
                        </ScrollViewer>
                    </TabItem>

                    <TabItem Header="Workflow">
                        <ScrollViewer>
                             <ItemsControl ItemsSource="{Binding WorkflowSteps}" Margin="10,20,0,20">
                                 <ItemsControl.ItemTemplate>
                                     <DataTemplate>
                                         <Grid Margin="0,0,0,10">
                                             <Grid.ColumnDefinitions>
                                                 <ColumnDefinition Width="30"/>
                                                 <ColumnDefinition Width="*"/>
                                             </Grid.ColumnDefinitions>
                                             
                                             <!-- Timeline Line & Node -->
                                             <Grid Grid.Column="0">
                                                 <!-- Vertical connecting line (hidden for the last item, handled imperfectly without multi-binding but good enough for now) -->
                                                 <Rectangle Width="2" Fill="{DynamicResource Gray300}" HorizontalAlignment="Center" Margin="0,15,0,-15"/>
                                                 
                                                 <!-- Colored Node -->
                                                 <Border x:Name="NodeBorder" Width="20" Height="20" CornerRadius="10" 
                                                         Background="{DynamicResource Gray200}" BorderBrush="{DynamicResource Gray300}" BorderThickness="2"
                                                         HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,2,0,0">
                                                         
                                                     <TextBlock x:Name="NodeIcon" Text="" FontFamily="Segoe Fluent Icons, Segoe MDL2 Assets" 
                                                                FontSize="10" Foreground="White" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                 </Border>
                                             </Grid>
                                             
                                             <!-- Content Card -->
                                             <Border Grid.Column="1" Background="{DynamicResource SurfaceBrush}" BorderBrush="{DynamicResource Gray200}" BorderThickness="1" CornerRadius="8" Padding="15" Margin="10,0,0,0">
                                                 <Grid>
                                                     <Grid.ColumnDefinitions>
                                                         <ColumnDefinition Width="Auto"/>
                                                         <ColumnDefinition Width="*"/>
                                                         <ColumnDefinition Width="Auto"/>
                                                     </Grid.ColumnDefinitions>
                                                     
                                                     <CheckBox Grid.Column="0" IsChecked="{Binding IsCompleted}" VerticalAlignment="Center" 
                                                               Command="{Binding DataContext.ToggleWorkflowCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                                               CommandParameter="{Binding}" Margin="0,0,12,0"/>
                                                               
                                                     <TextBlock x:Name="StepLabel" Grid.Column="1" Text="{Binding Label}" Foreground="{DynamicResource Gray700}" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                                     
                                                     <TextBlock Grid.Column="2" 
                                                                Visibility="{Binding IsCompleted, Converter={StaticResource BooleanToVisibilityConverter}}"
                                                                Foreground="{DynamicResource SuccessColor}" FontSize="12" VerticalAlignment="Center">
                                                         <Run Text="âœ“ "/>
                                                         <Run Text="{Binding Date, StringFormat=d}"/>
                                                     </TextBlock>
                                                 </Grid>
                                             </Border>
                                         </Grid>
                                         
                                         <!-- DataTriggers to color the timeline nodes based on state -->
                                         <DataTemplate.Triggers>
                                             <!-- Completed State -->
                                             <DataTrigger Binding="{Binding IsCompleted}" Value="True">
                                                 <Setter TargetName="NodeBorder" Property="Background" Value="{DynamicResource SuccessColor}"/>
                                                 <Setter TargetName="NodeBorder" Property="BorderBrush" Value="{DynamicResource SuccessColor}"/>
                                                 <Setter TargetName="NodeIcon" Property="Text" Value="&#xE73E;"/> <!-- Checkmark -->
                                                 <Setter TargetName="StepLabel" Property="Foreground" Value="{DynamicResource Gray800}"/>
                                             </DataTrigger>
                                             
                                             <!-- Current Active State (Not completed, but next in line) -->
                                             <DataTrigger Binding="{Binding IsCurrent}" Value="True">
                                                 <Setter TargetName="NodeBorder" Property="Background" Value="{DynamicResource PrimaryColor}"/>
                                                 <Setter TargetName="NodeBorder" Property="BorderBrush" Value="{DynamicResource PrimaryColor}"/>
                                                 <Setter TargetName="NodeIcon" Property="Text" Value="&#xE768;"/> <!-- Play or Right Arrow -->
                                                 <Setter TargetName="StepLabel" Property="Foreground" Value="{DynamicResource PrimaryColor}"/>
                                                 <Setter TargetName="StepLabel" Property="FontWeight" Value="Bold"/>
                                             </DataTrigger>
                                         </DataTemplate.Triggers>
                                     </DataTemplate>
                                 </ItemsControl.ItemTemplate>
                             </ItemsControl>
                        </ScrollViewer>
                    </TabItem>
                    
                    <TabItem Header="Deadlines">
                        <Grid Margin="0,16,0,0">
                             <Grid.RowDefinitions>
                                 <RowDefinition Height="Auto"/>
                                 <RowDefinition Height="*"/>
                             </Grid.RowDefinitions>
                             
                             <!-- Add Deadline -->
                             <Border Background="{DynamicResource Gray50}" Padding="10" CornerRadius="8" Margin="0,0,0,16">
                                 <Grid>
                                     <Grid.ColumnDefinitions>
                                         <ColumnDefinition Width="*"/>
                                         <ColumnDefinition Width="Auto"/>
                                         <ColumnDefinition Width="Auto"/>
                                     </Grid.ColumnDefinitions>
                                     <TextBox Text="{Binding NewDeadlineTitle}" Padding="6" Margin="0,0,8,0"/>
                                     <DatePicker Grid.Column="1" SelectedDate="{Binding NewDeadlineDate}" Margin="0,0,8,0"/>
                                     <Button Grid.Column="2" Content="Toevoegen" Command="{Binding AddDeadlineCommand}" Style="{StaticResource BtnPrimary}"/>
                                 </Grid>
                             </Border>
                             
                             <ScrollViewer Grid.Row="1">
                                 <ItemsControl ItemsSource="{Binding Deadlines}">
                                     <ItemsControl.ItemTemplate>
                                         <DataTemplate>
                                             <Border Background="{DynamicResource SurfaceBrush}" BorderBrush="{DynamicResource Gray200}" BorderThickness="0,0,0,1" Padding="12">
                                                 <Grid>
                                                     <Grid.ColumnDefinitions>
                                                         <ColumnDefinition Width="Auto"/> <!-- Checkbox -->
                                                         <ColumnDefinition Width="*"/>    <!-- Title -->
                                                         <ColumnDefinition Width="Auto"/> <!-- Date -->
                                                         <ColumnDefinition Width="Auto"/> <!-- Delete -->
                                                     </Grid.ColumnDefinitions>
                                                     
                                                     <CheckBox IsChecked="{Binding IsCompleted}" VerticalAlignment="Center"
                                                               Command="{Binding DataContext.ToggleDeadlineCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                               CommandParameter="{Binding}"/>
                                                               
                                                     <TextBlock Grid.Column="1" Text="{Binding Title}" VerticalAlignment="Center" Margin="12,0,0,0"
                                                                TextDecorations="{Binding IsCompleted, Converter={StaticResource BooleanToTextDecorationsConverter}}"/> <!-- Need converter or style -->
                                                                
                                                     <TextBlock Grid.Column="2" Text="{Binding DueDate, StringFormat=d}" VerticalAlignment="Center" Foreground="{DynamicResource Gray600}" Margin="12,0,12,0"/>
                                                     
                                                     <Button Grid.Column="3" Background="Transparent" BorderThickness="0" 
                                                             Command="{Binding DataContext.DeleteDeadlineCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                             CommandParameter="{Binding}">
                                                         <TextBlock Text="&#xE74D;" FontFamily="Segoe Fluent Icons, Segoe MDL2 Assets" Foreground="{DynamicResource DangerColor}"/>
                                                     </Button>
                                                 </Grid>
                                             </Border>
                                         </DataTemplate>
                                     </ItemsControl.ItemTemplate>
                                 </ItemsControl>
                             </ScrollViewer>
                        </Grid>
                    </TabItem>

                    <TabItem Header="Contact">
                        <ScrollViewer VerticalScrollBarVisibility="Auto">
                            <StackPanel Margin="0,16,0,16">
                                
                                <!-- Top Info Cards -->
                                <Grid Margin="0,0,0,16">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <!-- Student Contact Info -->
                                    <Border Grid.Column="0" Background="{DynamicResource SurfaceBrush}" BorderBrush="{DynamicResource Gray200}" BorderThickness="1" CornerRadius="8" Padding="16" Margin="0,0,8,0">
                                        <StackPanel>
                                            <TextBlock Text="Studentgegevens" FontWeight="Bold" FontSize="14" Margin="0,0,0,12" Foreground="{DynamicResource Gray800}"/>
                                            
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                                <TextBlock Text="&#xE715;" FontFamily="Segoe Fluent Icons, Segoe MDL2 Assets" VerticalAlignment="Center" Width="20" Foreground="{DynamicResource Gray500}"/>
                                                <TextBlock Text="{Binding Student.Email, TargetNullValue='Onbekend', FallbackValue='Onbekend'}" Foreground="{DynamicResource Gray700}" TextWrapping="Wrap"/>
                                            </StackPanel>
                                            
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                                <TextBlock Text="&#xE717;" FontFamily="Segoe Fluent Icons, Segoe MDL2 Assets" VerticalAlignment="Center" Width="20" Foreground="{DynamicResource Gray500}"/>
                                                <TextBlock Text="{Binding Student.Phone, TargetNullValue='Onbekend', FallbackValue='Onbekend'}" Foreground="{DynamicResource Gray700}" TextWrapping="Wrap"/>
                                            </StackPanel>
                                            
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="&#xE1D1;" FontFamily="Segoe Fluent Icons, Segoe MDL2 Assets" VerticalAlignment="Top" Width="20" Foreground="{DynamicResource Gray500}" Margin="0,2,0,0"/>
                                                <TextBlock Text="{Binding Student.Address, TargetNullValue='Onbekend', FallbackValue='Onbekend'}" Foreground="{DynamicResource Gray700}" TextWrapping="Wrap"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                    
                                    <!-- Company & Supervisor Info -->
                                    <Border Grid.Column="1" Background="{DynamicResource SurfaceBrush}" BorderBrush="{DynamicResource Gray200}" BorderThickness="1" CornerRadius="8" Padding="16" Margin="8,0,0,0">
                                        <StackPanel>
                                            <TextBlock Text="Bedrijfsbegeleider" FontWeight="Bold" FontSize="14" Margin="0,0,0,12" Foreground="{DynamicResource Gray800}"/>
                                            
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                                <TextBlock Text="&#xE77B;" FontFamily="Segoe Fluent Icons, Segoe MDL2 Assets" VerticalAlignment="Center" Width="20" Foreground="{DynamicResource Gray500}"/>
                                                <TextBlock Text="{Binding Student.CompanySupervisorName, TargetNullValue='Onbekend', FallbackValue='Onbekend'}" FontWeight="SemiBold" Foreground="{DynamicResource Gray800}" TextWrapping="Wrap"/>
                                            </StackPanel>
                                            
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                                <TextBlock Text="&#xE715;" FontFamily="Segoe Fluent Icons, Segoe MDL2 Assets" VerticalAlignment="Center" Width="20" Foreground="{DynamicResource Gray500}"/>
                                                <TextBlock Text="{Binding Student.CompanySupervisorEmail, TargetNullValue='Onbekend', FallbackValue='Onbekend'}" Foreground="{DynamicResource Gray700}" TextWrapping="Wrap"/>
                                            </StackPanel>
                                            
                                            <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                                                <TextBlock Text="&#xE717;" FontFamily="Segoe Fluent Icons, Segoe MDL2 Assets" VerticalAlignment="Center" Width="20" Foreground="{DynamicResource Gray500}"/>
                                                <TextBlock Text="{Binding Student.CompanySupervisorPhone, TargetNullValue='Onbekend', FallbackValue='Onbekend'}" Foreground="{DynamicResource Gray700}" TextWrapping="Wrap"/>
                                            </StackPanel>
                                            
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="&#xEB4F;" FontFamily="Segoe Fluent Icons, Segoe MDL2 Assets" VerticalAlignment="Top" Width="20" Foreground="{DynamicResource Gray500}" Margin="0,2,0,0"/>
                                                <TextBlock Text="{Binding Student.CompanyAddress, TargetNullValue='Onbekend', FallbackValue='Onbekend'}" Foreground="{DynamicResource Gray700}" TextWrapping="Wrap"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </Border>
                                </Grid>
                                
                                <!-- Contact Log List -->
                                <ItemsControl ItemsSource="{Binding Contacts}" Margin="0,0,0,16">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Background="{DynamicResource SurfaceBrush}" BorderBrush="{DynamicResource Gray200}" BorderThickness="1" CornerRadius="8" Margin="0,0,0,10" Padding="0">
                                                <Grid>
                                                    <Rectangle HorizontalAlignment="Left" Width="3" Fill="#3b82f6" RadiusX="2" RadiusY="2" Margin="0,1,0,1"/>
                                                    <StackPanel Margin="15,12,12,12">
                                                        <Grid Margin="0,0,0,4">
                                                            <TextBlock Text="{Binding Type}" FontWeight="Bold" Foreground="{DynamicResource InfoColor}"/>
                                                            <TextBlock Text="{Binding Date, StringFormat=d}" HorizontalAlignment="Right" Foreground="{DynamicResource Gray600}" FontSize="12"/>
                                                        </Grid>
                                                        <TextBlock Text="{Binding Content}" TextWrapping="Wrap"/>
                                                    </StackPanel>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                            <!-- Add Contact Box -->
                            <Border Background="{DynamicResource Gray50}" BorderBrush="{DynamicResource Gray200}" BorderThickness="1" CornerRadius="8" Padding="16" Margin="0,0,0,16">
                                <StackPanel>
                                    <TextBlock Text="Nieuw contactmoment" FontWeight="Bold" Margin="0,0,0,8"/>
                                    <Grid Margin="0,0,0,8">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <DatePicker SelectedDate="{Binding NewContactDate}" Margin="0,0,4,0"/>
                                        <!-- Simple ComboBox for types -->
                                        <ComboBox SelectedValue="{Binding NewContactType}" SelectedValuePath="Content" Grid.Column="1" Margin="4,0,0,0">
                                            <ComboBoxItem Content="Email"/>
                                            <ComboBoxItem Content="Telefoon"/>
                                            <ComboBoxItem Content="Gesprek"/>
                                            <ComboBoxItem Content="Review"/>
                                        </ComboBox>
                                    </Grid>
                                    <TextBox Text="{Binding NewContactContent}" Height="60" TextWrapping="Wrap" AcceptsReturn="True" Margin="0,0,0,8" Padding="4"/>
                                    <Button Content="Toevoegen" Command="{Binding AddContactCommand}" Style="{StaticResource BtnPrimary}" HorizontalAlignment="Right"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                        </ScrollViewer>
                    </TabItem>
                    
                    <TabItem Header="Bestanden">
                        <Grid Margin="0,16,0,0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <Button Content="ðŸ“‚ Bestand Toevoegen" Command="{Binding AddFileCommand}" Style="{StaticResource BtnSecondary}" HorizontalAlignment="Left" Margin="0,0,0,16"/>
                            
                            <ScrollViewer Grid.Row="1">
                                <ItemsControl ItemsSource="{Binding Attachments}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                             <Border Background="{DynamicResource SurfaceBrush}" BorderBrush="{DynamicResource Gray200}" BorderThickness="0,0,0,1" Padding="12">
                                                 <Grid>
                                                     <Grid.ColumnDefinitions>
                                                         <ColumnDefinition Width="Auto"/> <!-- Icon -->
                                                         <ColumnDefinition Width="*"/>    <!-- Name -->
                                                         <ColumnDefinition Width="Auto"/> <!-- Actions -->
                                                     </Grid.ColumnDefinitions>
                                                     
                                                     <TextBlock Text="&#xE8A5;" FontFamily="Segoe Fluent Icons, Segoe MDL2 Assets" FontSize="16" VerticalAlignment="Center" Margin="0,0,12,0"/>
                                                     
                                                     <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                                         <TextBlock Text="{Binding FileName}" FontWeight="SemiBold"/>
                                                         <TextBlock Text="{Binding UploadDate, StringFormat=g}" FontSize="12" Foreground="{DynamicResource Gray600}"/>
                                                     </StackPanel>
                                                     
                                                     <StackPanel Grid.Column="2" Orientation="Horizontal">
                                                         <Button Content="Openen" Style="{StaticResource BtnSecondary}" Padding="8,4" Margin="0,0,8,0"
                                                                 Command="{Binding DataContext.OpenFileCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                                 CommandParameter="{Binding}"/>
                                                         <Button Background="Transparent" BorderThickness="0"
                                                                 Command="{Binding DataContext.DeleteFileCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                                 CommandParameter="{Binding}">
                                                             <TextBlock Text="&#xE74D;" FontFamily="Segoe Fluent Icons, Segoe MDL2 Assets" Foreground="{DynamicResource DangerColor}"/>
                                                         </Button>
                                                     </StackPanel>
                                                 </Grid>
                                             </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Grid>
                    </TabItem>

                    <TabItem Header="Notities">
                        <Grid Margin="0,16,0,0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <!-- Rich Text Toolbar -->
                            <ToolBarTray Grid.Row="0" Background="Transparent" IsLocked="True">
                                <ToolBar Background="Transparent" BorderThickness="0" Margin="0,0,0,8">
                                    <Button Command="EditingCommands.ToggleBold" ToolTip="Vetgedrukt (Ctrl+B)" FontWeight="Bold" Content="B" Width="24" Background="Transparent" BorderThickness="0"/>
                                    <Button Command="EditingCommands.ToggleItalic" ToolTip="Cursief (Ctrl+I)" FontStyle="Italic" Content="I" Width="24" Background="Transparent" BorderThickness="0"/>
                                    <Button Command="EditingCommands.ToggleUnderline" ToolTip="Onderstreept (Ctrl+U)" Width="24" Background="Transparent" BorderThickness="0">
                                        <TextBlock Text="U" TextDecorations="Underline"/>
                                    </Button>
                                    <Separator/>
                                    <Button Command="EditingCommands.ToggleBullets" ToolTip="Opsomming" Content="â€¢" Width="24" Background="Transparent" BorderThickness="0"/>
                                    <Button Command="EditingCommands.ToggleNumbering" ToolTip="Genummerde lijst" Content="1." Width="24" Background="Transparent" BorderThickness="0"/>
                                </ToolBar>
                            </ToolBarTray>
                            
                            <RichTextBox x:Name="NotesRichTextBox" Grid.Row="1" BorderThickness="1" BorderBrush="{DynamicResource Gray200}" Background="{DynamicResource SurfaceBrush}" Foreground="{DynamicResource TextPrimaryColor}" Padding="8" helpers:RichTextBoxHelper.Rtf="{Binding Student.Notes, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" AcceptsReturn="True" VerticalScrollBarVisibility="Auto">
                                <RichTextBox.Resources>
                                    <Style TargetType="{x:Type Paragraph}">
                                        <Setter Property="Margin" Value="0,0,0,8"/>
                                    </Style>
                                </RichTextBox.Resources>
                            </RichTextBox>
                            
                            <Button Grid.Row="2" Content="Opslaan" Command="{Binding SaveNotesCommand}" Style="{StaticResource BtnPrimary}" HorizontalAlignment="Right" Margin="0,10,0,0"/>
                        </Grid>
                    </TabItem>
                </TabControl>
            </Grid>
        </Grid>
    </Border>
</UserControl>
